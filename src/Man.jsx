/*
Auto-generated by: https://github.com/pmndrs/gltfjsx
*/

import React, { useRef, useMemo, useEffect } from "react";
import { useGLTF, useAnimations } from "@react-three/drei";
import { useFrame } from "@react-three/fiber";
import { RigidBody, CapsuleCollider } from "@react-three/rapier";
import * as THREE from "three";

export function Man(props) {
  const group = useRef();
  const characterRef = useRef();
  
  const { nodes, materials, animations } = useGLTF("/man.gltf");
  const { actions } = useAnimations(animations, group);

  const dragAngForce = useMemo(() => new THREE.Vector3());

  const autoBalanceDampingC = 0.025
  const autoBalanceDampingOnY = 0.02
  const autoBalanceSpringK = 0.4

  const autoBalanceCharacter = () => {
    dragAngForce.set(
      -autoBalanceSpringK * characterRef.current.rotation().x -
        characterRef.current.angvel().x * autoBalanceDampingC,
      -autoBalanceSpringK * characterRef.current.rotation().y -
        characterRef.current.angvel().y * autoBalanceDampingOnY,
      -autoBalanceSpringK * characterRef.current.rotation().z -
        characterRef.current.angvel().z * autoBalanceDampingC
    );
    characterRef.current.applyTorqueImpulse(dragAngForce, true);
  };

  useFrame((state, delta) => {
    autoBalanceCharacter();
  })

  useEffect(() => {
    actions['Idle 01'].play()
  }, [actions])

  return (
    <RigidBody
      {...props}
      colliders={false}
      friction={-0.3}
      gravityScale={1.2}
      ref={characterRef}
    >
      <CapsuleCollider
        name="player"
        args={[0.4, 0.3]}
        position={[0, .68, 0]}
      />
      <group ref={group} dispose={null} scale={0.03}>
        <group>
          <group
            name="Root-Global"
            rotation={[-Math.PI, 0, -Math.PI]}
            scale={[-1, 1, 1]}
          >
            <group name="Root-Local" />
            <group name="Controller-Global" position={[0, 25, 0]}>
              <group name="Controller-Local" />
              <group
                name="Hip-Global"
                position={[-0.134, 0, -0.287]}
                rotation={[-0.08, 0.71, 0.073]}
              >
                <mesh
                  name="Hip-Local"
                  castShadow
                  receiveShadow
                  geometry={nodes["Hip-Local"].geometry}
                  material={materials["Hip-Material"]}
                  position={[0, 0, 0.5]}
                />
                <group
                  name="Belly-Global"
                  position={[0, 2.5, 0]}
                  rotation={[0, -0.087, 0]}
                >
                  <mesh
                    name="Belly-Local"
                    castShadow
                    receiveShadow
                    geometry={nodes["Belly-Local"].geometry}
                    material={materials["Belly-Material"]}
                    position={[0, 2.5, 0]}
                  />
                  <group
                    name="Chest-Global"
                    position={[0, 4, 0]}
                    rotation={[0.087, -0.135, -0.012]}
                  >
                    <mesh
                      name="Chest-Local"
                      castShadow
                      receiveShadow
                      geometry={nodes["Chest-Local"].geometry}
                      material={materials["ChestA-Material"]}
                      position={[0, 5.668, -0.051]}
                    />
                    <group
                      name="Head-Global"
                      position={[-0.008, 10.053, 0.089]}
                      rotation={[-0.046, -0.51, 0.046]}
                    >
                      <mesh
                        name="Head-Local"
                        castShadow
                        receiveShadow
                        geometry={nodes["Head-Local"].geometry}
                        material={materials["Head_A-Material"]}
                        position={[0, 8, -0.5]}
                      />
                    </group>
                    <group
                      name="Left_Arm-Global"
                      position={[-7.241, 8.778, 0.026]}
                      rotation={[0.042, -0.2, 1.408]}
                    >
                      <mesh
                        name="Left_Arm-Local"
                        castShadow
                        receiveShadow
                        geometry={nodes["Left_Arm-Local"].geometry}
                        material={materials["LeftArm-Material"]}
                        position={[-5, 0.5, -0.5]}
                      />
                      <group
                        name="Left_Forearm-Global"
                        position={[-11, 0, -0.5]}
                        rotation={[0.053, 0.714, -0.099]}
                      >
                        <mesh
                          name="Left_Forearm-Local"
                          castShadow
                          receiveShadow
                          geometry={nodes["Left_Forearm-Local"].geometry}
                          material={materials["LeftForeArm-Material"]}
                          position={[-3.5, 0.557, 0.001]}
                        />
                        <group
                          name="Left_Hand-Global"
                          position={[-8, 0, 0]}
                          rotation={[-Math.PI / 2, -0.183, 0]}
                        >
                          <mesh
                            name="Left_Hand-Local"
                            castShadow
                            receiveShadow
                            geometry={nodes["Left_Hand-Local"].geometry}
                            material={materials["LeftHand-Material"]}
                            position={[-2, -0.5, -0.5]}
                          />
                        </group>
                      </group>
                    </group>
                    <group
                      name="Right_Arm-Global"
                      position={[7.261, 8.946, 0.044]}
                      rotation={[0.182, -0.316, -1.233]}
                    >
                      <mesh
                        name="Right_Arm-Local"
                        castShadow
                        receiveShadow
                        geometry={nodes["Right_Arm-Local"].geometry}
                        material={materials["RightArm-Material"]}
                        position={[5, 0.5, -0.5]}
                      />
                      <group
                        name="Right_Forearm-Global"
                        position={[11, 0, -0.5]}
                        rotation={[0, -0.554, -0.087]}
                      >
                        <mesh
                          name="Right_Forearm-Local"
                          castShadow
                          receiveShadow
                          geometry={nodes["Right_Forearm-Local"].geometry}
                          material={materials["RightForeArm-Material"]}
                          position={[3.5, 0.557, 0.001]}
                        />
                        <group
                          name="Right_Hand-Global"
                          position={[8, 0, 0]}
                          rotation={[-2.106, -0.175, 0.578]}
                        >
                          <mesh
                            name="Right_Hand-Local"
                            castShadow
                            receiveShadow
                            geometry={nodes["Right_Hand-Local"].geometry}
                            material={materials["RightHand-Material"]}
                            position={[2, -0.5, -0.5]}
                          />
                        </group>
                      </group>
                    </group>
                  </group>
                </group>
                <group
                  name="Right_Thigh-Global"
                  position={[4, -0.5, 0]}
                  rotation={[-0.057, 0.341, 0.075]}
                >
                  <mesh
                    name="Right_Thigh-Local"
                    castShadow
                    receiveShadow
                    geometry={nodes["Right_Thigh-Local"].geometry}
                    material={materials["RightThigh-Material"]}
                    position={[-0.553, -5.5, 1.443]}
                  />
                  <group
                    name="Right_Leg-Global"
                    position={[0.5, -12, -0.5]}
                    rotation={[0.458, 0, 0]}
                  >
                    <mesh
                      name="Right_Leg-Local"
                      castShadow
                      receiveShadow
                      geometry={nodes["Right_Leg-Local"].geometry}
                      material={materials["RightLeg-Material"]}
                      position={[-1.01, -4, 0.837]}
                    />
                    <group
                      name="Right_Foot-Global"
                      position={[0, -10, 0.5]}
                      rotation={[-0.3, 0.138, -0.064]}
                    >
                      <mesh
                        name="Right_Foot-Local"
                        castShadow
                        receiveShadow
                        geometry={nodes["Right_Foot-Local"].geometry}
                        material={materials["Rightfoot-Material"]}
                        position={[0, -1.5, 2]}
                      />
                    </group>
                  </group>
                </group>
                <group
                  name="Left_Thigh-Global"
                  position={[-4, -0.5, 0]}
                  rotation={[-0.175, -0.029, -0.1]}
                >
                  <mesh
                    name="Left_Thigh-Local"
                    castShadow
                    receiveShadow
                    geometry={nodes["Left_Thigh-Local"].geometry}
                    material={materials["LeftThigh-Material"]}
                    position={[0.553, -6, 0.443]}
                  />
                  <group
                    name="Left_Leg-Global"
                    position={[-0.5, -12, -0.5]}
                    rotation={[0.343, 0.021, 0.073]}
                  >
                    <mesh
                      name="Left_Leg-Local"
                      castShadow
                      receiveShadow
                      geometry={nodes["Left_Leg-Local"].geometry}
                      material={materials["LeftLeg-Material"]}
                      position={[1.01, -4, 0.837]}
                    />
                    <group
                      name="Left_Foot-Global"
                      position={[0, -10, 0.5]}
                      rotation={[-0.11, -0.424, 0.016]}
                    >
                      <mesh
                        name="Left_Foot-Local"
                        castShadow
                        receiveShadow
                        geometry={nodes["Left_Foot-Local"].geometry}
                        material={materials["LeftFoot-Material"]}
                        position={[0, -1.5, 2]}
                      />
                    </group>
                  </group>
                </group>
              </group>
            </group>
          </group>
        </group>
      </group>
    </RigidBody>
  );
}

useGLTF.preload("/man.gltf");
